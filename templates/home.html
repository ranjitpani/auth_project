{% extends "base.html" %}
{% load static %}
{% block title %}Home{% endblock %}
{% block content %}
<style>
*{box-sizing:border-box}
a{ text-decoration:none; color:inherit }
body{
    margin:0;
    font-family:'Poppins',sans-serif;
    background:linear-gradient(180deg,#eef4ff,#ffffff);
    overflow-x:hidden;
}
/* ================= STICKY TOP ================= */
.sticky-top-bar{
    position:sticky;
    top:0;
    z-index:1000;
    background:#fff;
    padding:10px;
    box-shadow:0 2px 8px rgba(0,0,0,.08);
    display:flex;
    flex-direction:column;
    gap:10px;
}
/* ================= SEARCH ================= */
.search-wrapper{position:relative}
.search-container{
    display:flex;
    gap:8px;
    width:100%;
}
.search-container input{
    flex:1;
    min-width:0;
    padding:8px 10px;
    border-radius:8px;
    border:1px solid #ccc;
    font-size:14px;
}
.search-container button{
    padding:8px 14px;
    border:none;
    border-radius:8px;
    background:#007bff;
    color:#fff;
    font-size:16px;
}
/* ================= LIVE SEARCH ================= */
.live-search-box{
    position:absolute;
    top:46px;
    left:0;
    right:0;
    background:#fff;
    border-radius:12px;
    box-shadow:0 4px 20px rgba(0,0,0,.15);
    display:none;
    z-index:2000;
    max-height:300px;
    overflow-y:auto;
}
.live-item{
    display:flex;
    gap:10px;
    padding:10px;
    align-items:center;
    border-bottom:1px solid #eee;
}
.live-item img{
    width:40px;
    height:40px;
    border-radius:8px;
}
.live-item:hover{background:#f2f7ff}
/* ================= CATEGORY ================= */
.category-bar{
    display:flex;
    gap:14px;
    overflow-x:auto;
    padding:6px 4px;
}
.category-bar::-webkit-scrollbar{height:5px}
.category-bar::-webkit-scrollbar-thumb{
    background:#007bff;
    border-radius:4px;
}
.category-item{
    min-width:70px;
    text-align:center;
    font-size:13px;
}
.category-item img{
    width:42px;
    height:42px;
    border-radius:50%;
    display:block;
    margin:0 auto 4px;
    transition:.3s;
}
.category-bar.shrink img{
    width:26px;
    height:26px;
}
/* ================= STORES ================= */
.store-title{
    padding:10px;
    font-size:18px;
    font-weight:600;
}
.store-container{
    display:flex;
    gap:12px;
    overflow-x:auto;
    padding:10px;
    scroll-snap-type:x mandatory;
}
.store-card{
    flex:0 0 120px;
    scroll-snap-align:start;
    background:#fff;
    border-radius:12px;
    padding:10px;
    text-align:center;
    box-shadow:0 3px 12px rgba(0,0,0,.08);
}
.store-card img{
    width:50px;
    height:50px;
    border-radius:50%;
    margin-bottom:5px;
}
.store-card h4{
    margin:0;
    font-size:14px;
    font-weight:500;
}
/* ================= PRODUCTS ================= */
.product-title{
    padding:10px;
    font-size:18px;
    font-weight:600;
}
.container-flex{
    display:flex;
    gap:12px;
    overflow-x:auto;
    padding:10px;
    scroll-snap-type:x mandatory;
}
.product-card{
    flex:0 0 160px;
    scroll-snap-align:start;
    background:#fff;
    border-radius:12px;
    padding:10px;
    box-shadow:0 3px 12px rgba(0,0,0,.08);
}
.product-card img{
    width:100%;
    height:120px;
    object-fit:cover;
    border-radius:10px;
}
.product-card h4{
    margin:6px 0;
    font-size:14px;
    font-weight:500;
}
/* ================= PRICE ================= */
.price-row{
    font-size:13px;
    display:flex;
    gap:6px;
    align-items:center;
    flex-wrap:wrap;
}
.old-price{
    text-decoration:line-through;
    color:#888;
}
.new-price{
    font-weight:600;
}
.off-badge{
    background:#35e544;
    color:#fff;
    font-size:11px;
    padding:2px 6px;
    border-radius:6px;
}
</style>

<!-- ================= TOP BAR ================= -->
<div class="sticky-top-bar">
<form method="get" action="{% url 'home' %}">
<div class="search-wrapper">
    <div class="search-container">
        <input type="text" name="product_q" placeholder="Search product">
        <input type="text" name="store_q" placeholder="Search store">
        <button type="submit">üîç</button>
    </div>
</div>
</form>

<div id="categoryBar" class="category-bar">
    <!-- All Category -->
    <a href="?category=all">
        <div class="category-item">
            <i class="fa-solid fa-suitcase"></i>
            All
        </div>
    </a>
    {% for cat in store_categories %}
    <a href="?category={{ cat.id }}">
        <div class="category-item">
            {% if cat.icon %}
                <img src="{{ cat.icon.url }}">
            {% elif cat.icon_url %}
                <img src="{{ cat.icon_url }}">
            {% else %}
                <img src="https://upload.wikimedia.org/wikipedia/commons/2/2f/Google_2015_logo.svg">
            {% endif %}
            {{ cat.name }}
        </div>
    </a>
    {% endfor %}
</div>
</div>

<!-- ================= STORES ================= -->
<div class="store-title">All Stores</div>
<div class="store-container">
{% for store in stores %}
<div class="store-card">
<a href="{% url 'store_detail' store.id %}">
    {% if store.image %}
        <img src="{{ store.image.url }}">
    {% else %}
        <img src="{% static 'default_store.jpg' %}">
    {% endif %}
    <h4>{{ store.name }}</h4>
</a>
</div>
{% endfor %}
</div>

<!-- ================= PRODUCTS ================= -->
{% for category, products in products_by_category.items %}
<div class="product-title">{{ category }}</div>
<div class="container-flex">
{% for product in products %}
<div class="product-card">
<a href="{% url 'product_detail' product.id %}">
    {% if product.image %}
        <img src="{{ product.image.url }}">
    {% else %}
        <img src="{% static 'default_product.jpg' %}">
    {% endif %}
    <h4>{{ product.name }}</h4>
    <div class="price-row">
    {% if product.discounted_price %}
        <span class="old-price">‚Çπ{{ product.price }}</span>
        <span class="new-price">‚Çπ{{ product.discounted_price }}</span>
        <span class="off-badge">
            {{ product.discount_percentage }}% OFF
        </span>
    {% else %}
        <span class="new-price">‚Çπ{{ product.price }}</span>
    {% endif %}
    </div>
</a>
</div>
{% endfor %}
</div>
{% endfor %}

<script>
/* CATEGORY SHRINK */
window.addEventListener("scroll",()=>{
    document.getElementById("categoryBar")
    .classList.toggle("shrink",window.scrollY>80);
});


</script>
{% endblock %}